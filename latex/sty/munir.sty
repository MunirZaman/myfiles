% Package munir.sty

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{munir}

% packages

%amsmath
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{amsfonts}
\RequirePackage{amsthm}

\RequirePackage{tcolorbox}
\RequirePackage[framemethod=TikZ]{mdframed} 
\RequirePackage{thmtools}
\RequirePackage[colorlinks=true]{hyperref}

\RequirePackage{xcolor}
\RequirePackage{ifthen}

% hyperref setup
\hypersetup{urlcolor=RubineRed,linkcolor=RoyalBlue,citecolor=ForestGreen}

% tikz
\RequirePackage{tikz}
\usetikzlibrary{arrows.meta}

% macros
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceiling}[1]{\left\lceil #1 \right\rceil}
\newcommand{\ol}{\overline}
\newcommand{\ul}{\underline}
\newcommand{\dg}{^\circ} %% degree
\newcommand{\ii}{\item}

%Inequalities
\newcommand{\cycsum}{\sum_{\mathrm{cyc}}}
\newcommand{\symsum}{\sum_{\mathrm{sym}}}
\newcommand{\cycprod}{\prod_{\mathrm{cyc}}}
\newcommand{\symprod}{\prod_{\mathrm{sym}}}

%Geometry
\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}
\newcommand{\dang}{\measuredangle} %% Directed angle
\newcommand{\ray}[1]{\overrightarrow{#1}}
\newcommand{\seg}[1]{\overline{#1}}
\newcommand{\arc}[1]{\wideparen{#1}}

% number theory
\DeclareMathOperator{\ord}{ord}

% sets
\newcommand{\CC}{\mathbb C}
\newcommand{\NN}{\mathbb N}
\newcommand{\QQ}{\mathbb Q}
\newcommand{\RR}{\mathbb R}
\newcommand{\ZZ}{\mathbb Z}

\newcommand{\vocab}[1]{\textbf{\color{blue} #1}}

% moral
\newenvironment{moral}{%
	\begin{mdframed}[linecolor=green!70!black]%
	\bfseries\color{green!70!black}}%
	{\end{mdframed}}

% Fancy section and chapter heads. Thx evan!
\@ifundefined{KOMAClassName}{}{
	\@ifundefined{chapter}{}{
		\addtokomafont{partprefix}{\rmfamily}
		\renewcommand*{\partformat}{\color{purple}
			\scalebox{2.5}{\thepart}\enlargethispage{2em}}
		\addtokomafont{chapterprefix}{\raggedleft}
		\RedeclareSectionCommand[beforeskip=0.5em]{chapter}
		\renewcommand*{\chapterformat}{\mbox{%
			\scalebox{1.5}{\chapappifchapterprefix{\nobreakspace}}%
			\scalebox{2.718}{\color{purple}\thechapter}\enskip}}
	}
	\renewcommand*{\sectionformat}%
		{\color{purple}\S\thesection\enskip}
	\renewcommand*{\subsectionformat}%
		{\color{purple}\S\thesubsection\enskip}
	\renewcommand*{\subsubsectionformat}%
		{\color{purple}\S\thesubsubsection\enskip}
	\KOMAoptions{numbers=noenddot}
	%\usetocstyle{KOMAlike}
}


% thm boxes


\mdfdefinestyle{mdbluebox}{%
	roundcorner = 10pt,
	linewidth=1pt,
	skipabove=12pt,
	innerbottommargin=9pt,
	skipbelow=2pt,
	linecolor=blue,
	nobreak=true,
	backgroundcolor=TealBlue!5,
}
\declaretheoremstyle[
	headfont=\sffamily\bfseries\color{MidnightBlue},
	mdframed={style=mdbluebox},
	headpunct={\\[3pt]},
	postheadspace={0pt}
]{thmbluebox}
                                                             
\mdfdefinestyle{mdredbox}{%
	linewidth=0.5pt,
	skipabove=12pt,
	frametitleaboveskip=5pt,
	frametitlebelowskip=0pt,
	skipbelow=2pt,
	frametitlefont=\bfseries\sffamily,
	innertopmargin=4pt,
	innerbottommargin=8pt,
	nobreak=true,
	backgroundcolor=Salmon!5,
	linecolor=RawSienna,
}
\declaretheoremstyle[
	headfont=\bfseries\sffamily\color{RawSienna},
	mdframed={style=mdredbox},
	headpunct={\\[3pt]},
	postheadspace={0pt},
]{thmredbox}
                                                             
\mdfdefinestyle{mdgreenbox}{%
	skipabove=8pt,
	linewidth=2pt,
	rightline=false,
	leftline=true,
	topline=false,
	bottomline=false,
	linecolor=ForestGreen,
	backgroundcolor=ForestGreen!5,
}
\declaretheoremstyle[
	headfont=\bfseries\sffamily\color{ForestGreen!70!black},
	bodyfont=\normalfont,
	spaceabove=2pt,
	spacebelow=1pt,
	mdframed={style=mdgreenbox},
	headpunct={ --- },
]{thmgreenbox}
                                                             
\mdfdefinestyle{mdblackbox}{%
	skipabove=8pt,
	linewidth=3pt,
	rightline=false,
	leftline=true,
	topline=false,
	bottomline=false,
	linecolor=black,
	backgroundcolor=RedViolet!5!gray!5,
}
\declaretheoremstyle[
	headfont=\sffamily\bfseries,
	bodyfont=\normalfont\small,
	spaceabove=0pt,
	spacebelow=0pt,
	mdframed={style=mdblackbox}
]{thmblackbox}

% theorem, lemma, corollary, proposition, claim
\declaretheorem[style=thmbluebox,name=Theorem,numberwithin=section]{theorem}
\declaretheorem[style=thmbluebox,name=Lemma,sibling=theorem]{lemma}
\declaretheorem[style=thmbluebox,name=Proposition,sibling=theorem]{proposition}
\declaretheorem[style=thmbluebox,name=Corollary,numberwithin=theorem]{corollary}

\declaretheorem[style=thmbluebox,name=Theorem,numbered=no]{theorem*}
\declaretheorem[style=thmbluebox,name=Lemma,numbered=no]{lemma*}
\declaretheorem[style=thmbluebox,name=Proposition,numbered=no]{proposition*}
\declaretheorem[style=thmbluebox,name=Corollary,numbered=no]{corollary*}

\declaretheorem[style=thmgreenbox,name=Claim,sibling=theorem]{claim}
\declaretheorem[style=thmgreenbox,name=Claim,numbered=no]{claim*}

% Problem, Example
\declaretheorem[style=thmredbox,name=Example,sibling=theorem]{example}
\declaretheorem[style=thmredbox,name=Example,numbered=no]{example*}

\declaretheorem[style=thmredbox,name=Problem,sibling=theorem]{problem}
\declaretheorem[style=thmredbox,name=Problem,numbered=no]{problem*}

% Definition, Remark, Claim

\declaretheorem[style=thmblackbox,name=Remark,sibling=theorem]{remark}
\declaretheorem[style=thmblackbox,name=Remark,numbered=no]{remark*}

\declaretheoremstyle[
	spaceabove=5pt, spacebelow=5pt,
	headfont=\sffamily\bfseries,
	postheadspace={2pt}
]{plain}

\declaretheorem[style=plain,name=Definition,sibling=theorem]{definition}
\declaretheorem[style=plain,name=Definition,numbered=no]{definition*}

% Others

\declaretheorem[style=thmgreenbox,name=Conjecture,sibling=theorem]{conjecture}
\declaretheorem[style=thmgreenbox,name=Conjecture,numbered=no]{conjecture*}

\declaretheorem[style=plain,name=Exercise,sibling=theorem]{exercise}
\declaretheorem[style=plain,name=Exercise,numbered=no]{exercise*}

\declaretheorem[style=thmblackbox,name=Fact,sibling=theorem]{fact}
\declaretheorem[style=thmblackbox,name=Fact,numbered=no]{fact*}

\declaretheorem[style=plain,name=Question,sibling=theorem]{ques}
\declaretheorem[style=plain,name=Question,numbered=no]{ques*}

% proof and solution

\renewenvironment{proof}[1][]%
{{\sffamily\bfseries Proof\ifthenelse{\equal{#1}{}}{:}{ #1:}} }%
{{\begin{flushright}$\clubsuit$\end{flushright}}}

\newenvironment{sol}[1][]%
{{\sffamily\bfseries Solution\ifthenelse{\equal{#1}{}}{:}{ #1:}} }%
{{\begin{flushright}$\clubsuit$\end{flushright}}}

% hints

\newenvironment{hints}%
{\textbf{\textsf{Hints: }}\begin{itemize}}%
{\end{itemize}}

% Tricks&Techniques

\definecolor{Cerulean}{rgb}{0.0, 0.48, 0.65}
\definecolor{Capri}{rgb}{0.0, 0.75, 1.0}

\mdfdefinestyle{mdCapribox}{%
	roundcorner = 10pt,
	linewidth=1pt,
	skipabove=12pt,
	innerbottommargin=9pt,
	skipbelow=2pt,
	nobreak=true,
	linecolor=Cerulean,
	backgroundcolor=Capri!10,
}
\declaretheoremstyle[
	headfont=\sffamily\bfseries\color{Capri},
	mdframed={style=mdCapribox},
	headpunct={\\[3pt]},
	postheadspace={0pt},
]{Capribox}

\declaretheorem[style=Capribox,name=Tricks{\&}Techniques,numberwithin=section]{trick}
\declaretheorem[style=Capribox,name=Tricks{\&}Techniques,numbered=no]{trick*}

% code blocks
\newif\ifcode\codefalse
\DeclareOption{code}{\codetrue}

% page setup
\newif\ifpage\pagefalse
\DeclareOption{page}{\pagetrue}

% page header
\newif\ifhead\headfalse
\DeclareOption{head}{\headtrue}

%% include Date in header
\newif\ifheaddate\headdatefalse
\DeclareOption{date}{\headdatetrue}

%% use sans-serif fonts
\newif\ifsf\sffalse
\DeclareOption{sf}{\sftrue}

\ProcessOptions\relax

\ifcode
    \usepackage{minted}
    \newminted{pycon}{bgcolor=bg, linenos=true, tabsize =4}
    \setminted[pycon]{autogobble}
    \usepackage{tcolorbox}
    \tcbuselibrary{minted}

    \newtcblisting{tcbcode}[2][]{%
      colback=Black!5,
      listing only,
      minted options={
        mathescape
      },  
      minted language=#2,
      #1
    }

    \usemintedstyle{rainbow_dash}

    \definecolor{codebg}{RGB}{245, 247, 250}

    \def\codebg{codebg} % mdcode background color
    \def\codelinecolor{Gray} % mdcode line color
    \def\codelinewidth{0pt} % mdcode line width
    \def\coderound{2pt} % mdcode rounded corners
    \def\codelmargin{30pt} % mdcode innerleftmargin

	\def\codeframe{none} % minted frame line
    \def\codelinenos{true} % minted show line no
    \def\codefontsize{\footnotesize} % minted code font size

    \def\consolebg{codebg} % mdconsole background color
    \def\consolelinecolor{Gray} % mdconsole line color
    \def\consolelinewidth{0pt} % mdconsole line width
    \def\consoleround{2pt} % mdconsole rounded corners
    \def\consolelmargin{2.5pt} % mdconsole innerleftmargin
	
	\def\consoleframe{none} % minted frame line
    \def\consolelinenos{false} % minted show line no
    \def\consolefontsize{\footnotesize} % minted code font size

    % define new language
    \def\defcodelang#1#2{
    \newenvironment{#1}%
	 {\VerbatimEnvironment
	 \begin{mdcode}
	 \begin{minted}[#2]{#1}}
	 {\end{minted}
	 \end{mdcode}}

    \newenvironment{#1*}[1]%
	 {\VerbatimEnvironment
	 \begin{mdcode}
	 \begin{minted}[#2,##1]{#1}}
	 {\end{minted}
	 \end{mdcode}}
	}

    % define new console language
    \def\defconsolelang#1#2{
	\newenvironment{#1}%
	 {\VerbatimEnvironment
	 \begin{mdconsole}
	 \begin{minted}[#2]{#1}}
	 {\end{minted}
	 \end{mdconsole}}

	\newenvironment{#1*}[1]%
	 {\VerbatimEnvironment
	 \begin{mdconsole}
	 \begin{minted}[#2,##1]{#1}}
	 {\end{minted}
	 \end{mdconsole}}
    }

    % mdcode blocks
    \newenvironment{mdcode}[1][]%
    {\begin{mdframed}%
    [linecolor=\codelinecolor,
    linewidth=\codelinewidth,
    backgroundcolor=\codebg,
    skipabove=10pt,skipbelow=10pt,
    roundcorner=\coderound,
    splitbottomskip=6pt,splittopskip=12pt,
    innerleftmargin=\codelmargin, innerrightmargin=30pt,#1]}%
    {\end{mdframed}}

    % mdconsole blocks
    \newenvironment{mdconsole}[1][]%
    {\begin{mdframed}%
    [linecolor=\consolelinecolor,
    linewidth=\consolelinewidth,
    backgroundcolor=\consolebg,
    skipabove=10pt,skipbelow=10pt,
    roundcorner=\consoleround,
    splitbottomskip=6pt,splittopskip=12pt,
    innerleftmargin=\consolelmargin, innerrightmargin=30pt,#1]}%
    {\end{mdframed}}

    %\newcommand{\codetexdelimiters}{||}
    %escapeinside=\codetexdelimiters

    %python, pycon, ipython, cpp, julia, julia-repl

	%code environments
	\defcodelang{python}%
	{mathescape,
	texcomments,
	breaklines,
	linenos=\codelinenos,
	frame=\codeframe,
	fontsize=\codefontsize}

	\defcodelang{cpp}%
	{mathescape,
	texcomments,
	breaklines,
	linenos=\codelinenos,
	frame=\codeframe,
	fontsize=\codefontsize}

	\defcodelang{julia}%
	{mathescape,
	texcomments,
	breaklines,
	linenos=\codelinenos,
	frame=\codeframe,
	fontsize=\codefontsize}

	\defconsolelang{pycon}%
	{mathescape,
    texcomments,
    breaklines,
    linenos=\consolelinenos,
    frame=\consoleframe,
    fontsize=\consolefontsize}

	\defconsolelang{ipython}%
	{mathescape,
    texcomments,
    breaklines,
    linenos=\consolelinenos,
    frame=\consoleframe,
    fontsize=\consolefontsize}

	\defconsolelang{julia-repl}%
	{mathescape,
    texcomments,
    breaklines,
    linenos=\consolelinenos,
    frame=\consoleframe,
    fontsize=\consolefontsize}

	\def\usesimplecodestyle{
		\def\codeframe{none}
		\def\codelinenos{false}
		\def\codelmargin{10pt}
	}

\fi


%%fakesection \maketitle configuration
\@ifundefined{KOMAClassName}%
    {} % do nothing outside KOMA class
	{% If KOMA exists. . .
    \addtokomafont{subtitle}{\Large\sffamily}
	\setkomafont{author}{\Large\sffamily}
	\setkomafont{date}{\sffamily}
}

%% Page Setup
\providecommand{\thetitle}{\@title}
\providecommand{\theauthor}{\@author}
\providecommand{\thedate}{\@date}

\ifpage
	\@ifundefined{KOMAClassName}
	{
		\usepackage{fancyhdr}
		\setlength{\headheight}{0.75in}
		\setlength{\oddsidemargin}{0in}
		\setlength{\evensidemargin}{0in}
		\setlength{\voffset}{-1.0in}
		\setlength{\headsep}{10pt}
		\setlength{\textwidth}{6.5in}
		\setlength{\headwidth}{6.5in}
		\setlength{\textheight}{8.75in}
		\setlength{\parskip}{1ex plus 0.5ex minus 0.2ex}
		\setlength{\footskip}{0.3in}
		\ifhead
			\renewcommand{\headrulewidth}{0.5pt}
			\renewcommand{\footrulewidth}{0.0pt}
			\pagestyle{fancy}
			\lhead{Munir Uz Zaman}
			\chead{}
			\rhead{\nouppercase{\leftmark}}
			\lfoot{}
			\cfoot{\thepage}
			\rfoot{}
		\fi
	}
	{
		\usepackage[headsepline]{scrlayer-scrpage}
		\renewcommand{\headfont}{}
		%\addtolength{\textheight}{3.14cm}
		\setlength{\footskip}{0.5in}
		\setlength{\headsep}{10pt}

        \ifheaddate
		    \ihead{\sffamily\footnotesize\textbf{\theauthor} (\thedate)}
        \else
            \ihead{\sffamily\footnotesize\textbf{\theauthor}}
        \fi

		\automark{section}
		\chead{}
        \ohead{\footnotesize\textbf{\sffamily\color{purple}\thetitle}}
		%\cfoot{\pagemark}
	}
\fi

\ifsf
	\renewcommand{\familydefault}{\sfdefault} %% sans-serif text
	\usepackage[cm]{sfmath} %% sans-serif math
\fi


